### JWT

------

### 목차

[TOC]



------

#### jwt란?

JWT란(JSON Web Token) 인증에 필요한 정보들을 암호화시킨 JSON토큰을 의미한다.

구조

- Header, Payload, Signature로 구성
- Header 에는 JWT 에서 사용할 타입과 해시 알고리즘의 종류가 담겨있으며, Payload 는 서버에서 첨부한 사용자 권한 정보와 데이터가 담겨있다. 마지막으로 Signature 에는 Header, Payload 를 Base64 URL-safe Encode 를 한 이후 Header 에 명시된 해시함수를 적용하고, 개인키(Private Key)로 서명한 전자서명이 담겨있다.

##### Payload의 기본 구성?

토큰에서 사용할 정보가 저장되어 있다. JWT인증을 통해 알 수 있는 데이터다.

미리 정의된 정보

- iss:발행자
- exp:만료시간
- iat:발행시간



#### 보안

##### XSS(code injection attack)란?

Xss는 공격자가 의도하는 악의적인 js코드를 웹 브라우저에서 실행시키는것이다.

이를 통해 브라우저에 저장된 주요정보를 탈취할 수 있다.

- 로컬스토리지,쿠키,세선 등에 저장된 사용자 토큰의 탈취가 가능해짐.



##### CSRF(Cross Site Request Forgery)란?

사이트간 요청 위조 또는 크로스 사이트 요청위조를 뜻한다.

즉 다른 사이트에서 해당 사이트의 API실행시켜 정보를 탈취하는 공격이다.



##### 보안관련 이슈

###### `localStorage` 저장 방식

브라우저 저장소에 저장하는 방식이다. Javascript 내 **글로벌 변수**로 **읽기 / 쓰기 접근이 가능**하다.

- Xss 공격에 취약함



###### 쿠키 저장방식

브라우저에 쿠키로 저장되는데, 클라이언트가 HTTP 요청을 보낼 때마다 자동으로 쿠키가 서버에 전송된다. Javascript 내 **글로벌 변수**로 **읽기 / 쓰기 접근이 가능**하다.

- 쿠키의 httpOnly 옵션을 사용하면 Js에서 쿠키에 접근 자체가 불가능하다.그래서 XSS 공격으로 쿠키 정보를 탈취할 수 없다.

- 하지만, request를 보낼 수 있으므로 자동으로 request에 실리는 쿠키의 특성 상 요청을 위조 할 수 있다.



#### 보안관련 Token 저장방법

종합해보면 세션 `id`를 브라우저에 저장하는 방식은 어떤 방식이던지 보안 위험요소가 있으므로 JWT 이용한 인증 방식을 사용할 것이다. `refreshToken`만을 `secure` `httpOnly` 쿠키에 저장해 CSRF 공격을 방어할 것이다. `accessToken`은 웹 어플리케이션 내 로컬 변수에 저장해 사용하며, API를 요청할 때 `Authorization` 헤더에 넣어 보내준다. XSS 취약점을 이용한 API 요청 공격은 클라이언트와 서버에서 추가적으로 방어 해야 한다.









